<!DOCTYPE html>
<html lang='{{ lang }}'><head>
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>

{{fulltitle.zh =}}
{{ title }} — Ayu
{{metadescription.zh =}}
说明说明！

{{fulltitle.en =}}
{{ title }} — Site
{{metadescription.en =}}
A Description

{{siteheading.zh =}}甜鱼/Ayu
{{siteheading.en =}}Sweetfish Ayu

{{=}}
  <meta name='description' content='{{ metadescription }}'>
  <meta property='og:title' content='{{ fulltitle }}'>
  <meta property='og:type' content='website'>
  <meta property='og:image' content=''>
  <meta property='og:url' content=''>
  <meta property='og:description' content='{{ metadescription }}'>
  <meta property='og:locale' content='{{ lang }}'>
  {{@ otherlang in {'zh', 'en'} }}
    {{@ otherlang ~= lang }}
      <meta property='og:locale:alternate' content='{{ otherlang }}'>
    {{@ end }}
  {{@ end }}

  <link rel='alternate' type='application/rss+xml' href='/rss.{{ lang }}.xml' title='RSS feed'>
  <link rel='alternate' type='application/atom+xml' href='/atom.{{ lang }}.xml' title='Atom feed'>

  <title>{{ fulltitle }}</title>

  <link rel='stylesheet' href='/bin/{{ hashverfile('main.css') }}'>

  <style></style>
</head><body class='<!-- (dark) dark -->'>

{{
  cats = render('categories.txt').cats
}}

<div id='main-grid'>
<nav>
<h1>{{ siteheading }}</h1>
<ul>
  {{@ cat in cats}}
  <li><a class='pastel {{cat.name}}'
    href='/{{@ cat.name ~= "home"}}{{cat.name}}{{@ end}}'><span class='little-icons'>{{utf8.char(cat.icon)}}</span>{{cat.title}}</a></li>
  {{@ end}}
</ul>
{{ urlpath = (savepath == 'index' and '' or savepath) }}
<div id='icon-buttons'>
  <details id='lang-container'>
    <summary class='pastel miscellaneous little-icons' title='语言/Language'>🌐</summary>
    <div id='lang-list'>
      <a href='/{{ urlpath }}?lang=zh'>汉语/Chinese</a>
      <a href='/{{ urlpath }}?lang=en'>English/英语</a>
    </div>
  </details><a id='dark-toggle'
    href='/{{ urlpath }}?dark=<!-- (dark) 0 1 -->' class='pastel miscellaneous little-icons' title='{{ tr({
      zh = '切换深色/浅色主题',
      en = 'Toggle dark/light theme',
    }) }}'>🌙</a>
</div>
</nav>

<main>

<div id='top-fleuron'></div>

<article>
{{ contents }}
</article>

</main>

<aside>
Related links
</aside>
</div>

<footer>
<span>
  <span>Brimming with <span class='little-icons' style='display: inline-block; transform: rotate(-8deg)'>&#x1f31f;</span></span>
</span>
<br>
{{ render('timeofday.html') }}
</footer>

<style>
{{@ distbuild }}
@font-face {
  font-family: 'AaKaiSong';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(/bin/fonts/AaKaiSong.stray-{{ basehash(savepath) }}.woff2) format('woff2');
}
{{ AaKaiSong_css }}
{{@ end }}
{{@ not distbuild }}
@font-face {
  font-family: 'AaKaiSong';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(/bin/fonts-zh/AaKaiSong2-full.woff2) format('woff2');
  unicode-range: U+0800-FFFF;
}
{{@ end }}

{{@ curcat}}
{{ hue, sat, val1, val2 = table.unpack(cats[curcat].tint) }}
#top-fleuron {
  filter: hue-rotate({{hue}}deg);
}

div[role='separator'] {
  filter: hue-rotate({{hue}}deg);
}

main header h1 { color: hsl({{hue}}deg, {{sat}}%, {{val1 / 2}}%); }
body.dark main header h1 { color: hsl({{hue}}deg, {{sat + (100 - sat) * 0.6}}%, {{val1 + (100 - val1) * 0.7}}%); }

blockquote {
  border-inline-start: 0.1em solid hsl({{hue}}deg, {{sat}}%, {{val1}}%);
  background: hsla({{hue}}deg, {{sat}}%, {{val1}}%, 4%);
}
body.dark blockquote {
  border-inline-start: 0.1em solid hsl({{hue}}deg, {{sat}}%, {{100 - (100 - val1) * 0.45}}%);
  background: hsla({{hue}}deg, {{sat}}%, {{100 - (100 - val1) * 0.45}}%, 8%);
}
blockquote.quote::before,
blockquote.quote::after {
  color: hsla({{hue}}deg, {{sat}}%, {{val1}}%, 30%);
}
{{@ end}}
</style>

<script>
(() => {
const langContainer = document.getElementById('lang-container')
const langList = document.getElementById('lang-list')
const tempEvents = [
  [document.body, 'mousedown', (e) => closeLangContainer(e)],
  [document.body, 'keydown', (e) => { if (e.keyCode === 27) closeLangContainer(e) }],
  [langContainer, 'mousedown', (e) => e.stopPropagation()],
]
const clearTempEvents = () => {
  for (const [el, key, fn] of tempEvents)
    el.removeEventListener(key, fn)
}
const closeLangContainer = (e) => {
  langContainer.open = false
  clearTempEvents()
  e.preventDefault()
}
langContainer.addEventListener('toggle', (e) => {
  if (langContainer.open) {
    for (const [el, key, fn] of tempEvents)
      el.addEventListener(key, fn)
  } else {
    clearTempEvents()
  }
})

const darkToggle = document.getElementById('dark-toggle')
darkToggle.addEventListener('click', (e) => {
  const isDark = !document.body.classList.contains('dark')
  document.body.classList.toggle('dark')
  document.cookie = 'dark=' + (isDark ? '1' : '0') + '; SameSite=Strict; Max-Age=2592000'
  darkToggle.href = darkToggle.href.substring(0, darkToggle.href.length - 1) + (isDark ? '0' : '1')
  e.preventDefault()
})

if (navigator.userAgent.indexOf('Chrome/') !== -1)
  document.body.classList.add('ua-inline-height')

const navList = document.querySelector('nav > ul')
const navListFirst = navList.children[0]
const navListLast = navList.children[navList.children.length - 1]
const ixobs = new IntersectionObserver((entries) => {
  entries.forEach((ent) => {
    const isFirst = (ent.target === navListFirst)
    const isVisible = (ent.intersectionRatio >= 0.6)
    if (isVisible)
      navList.classList.remove(isFirst ? 'scroll-shadow-start' : 'scroll-shadow-end')
    else
      navList.classList.add(isFirst ? 'scroll-shadow-start' : 'scroll-shadow-end')
  })
}, {
  root: navList,
  rootMargin: '0px',
  threshold: [0.6],
})
ixobs.observe(navListFirst)
ixobs.observe(navListLast)

document.body.classList.add('js')
})()
</script>

</body></html>
