{{
  cats = render('categories.txt').cats
  title = tr(cats[curcat].longtitle) or cats[curcat].title
  intro = tr(cats[curcat].intro)
}}
<header>
  <h1>{{ title }}</h1>
  {{@ intro }}
    <p>{{ intro }}</p>
  {{@ end }}
</header>
<section class='banner-list'>
{{@ cats[curcat].pagelist}}
<a href='/{{ name }}' class='item-entry'><section>
  {{ page = render('items/' .. name .. '/page.txt') }}
  {{@ page.bannerimg }}
  <div class='item-banner'>
    {{
      style = nil
      if page.bannerimgpos then
        local x, y = table.unpack(split(page.bannerimgpos, ','))
        style = 'object-position: ' .. x .. '% ' .. y .. '%'
      end
    }}
    {{ image(file(page.bannerimg, 'items/' .. name), nil, nil, style) }}
    <h1{{@ dark}} class='item-title-dark'{{@ end}}>{{ page.title }}</h1>
  </div>
  {{@ end }}
  {{@ not page.bannerimg }}
  <h1>{{ page.title }}</h1>
  {{@ end }}
  <section class='item-peek'>
    <p><span class='intro-text'>{{ page.intro }}</span><span class='date-container'>{{ renderdate(page.date, true) }}</span></p>
    <div class='clear-float'></div>
  </section>
</section></a>
<div role='separator' class='item-separator'></div>
{{@ end}}
</section>

<style>
a.item-entry {
  color: inherit;
  text-decoration: inherit;
  margin-block: 1rem 1.5rem;
}
.item-banner {
  height: 10rem;
  position: relative;
}
.item-banner > img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.item-banner > h1 {
  position: absolute;
  inset-inline-start: 0;
  inset-block-end: 1rem;
  font-size: 1.5rem;
  margin: 0;
  padding-inline: 1.3rem 1.8rem;
  text-shadow: #fdfdfd 0.05em 0.05em;
  border-width: 0;
  border-image: url(/bin/chalk-bg-w.png) 18 fill / 0.3em / 0.1em 0;
}
.item-peek {
  margin-inline: 1.3rem;
}
.item-peek > p > span.date-container {
  float: right; /* inline-end */
  margin-inline-start: 2em;
  margin-block-start: 0.2em;
}
.item-peek > .clear-float {
  clear: both;
  margin-block-start: -2em;
}
h1.item-title-dark {
  color: #fdfdfd;
  text-shadow: #181410 0.05em 0.05em;
  border-image: url(/bin/chalk-bg-b.png) 18 fill / 0.3em / 0.1em 0;
}
div[role='separator'].item-separator {
  margin-block: 1em 1.5em;
}

{{@ compact }}
header > p {
  text-indent: 2em;
  margin-block-end: 1.5em;
}
.banner-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-column-gap: 1em;
}
.banner-list > div.item-separator {
  grid-column: 1 / span 2;
  margin-block: -0.5em 0.5em;
  transform: rotate(5deg);
}
html[dir="rtl"] .banner-list > div.item-separator {
  transform: rotate(-5deg);
}
.banner-list > *:nth-child(4n+2) {
  display: none;
}
.banner-list > *:nth-child(4n+3) {
  margin-block-start: 2em;
}
a.item-entry {
  margin-block: 0;
}

@media (max-width: 115vh), (max-width: 48rem) {
  .banner-list {
    display: initial;
  }
  .banner-list > *:nth-child(4n+3) {
    margin-block-start: unset;
  }
  .banner-list > div.item-separator {
    transform: unset;
    margin-block: 0.5em;
  }
  .banner-list > *:nth-child(4n+2) {
    display: block;
  }
  a.item-entry > section {
    display: grid;
  }
  a.item-entry:nth-child(4n+1) > section {
    grid-template-columns: 3fr 2fr;
  }
  a.item-entry:nth-child(4n+3) > section {
    grid-template-columns: 2fr 3fr;
  }
  a.item-entry:nth-child(4n+3) > section > .item-banner { grid-column: 2; }
  .item-banner > img {
    border-radius: 0.75em;
  }
  a.item-entry:nth-child(4n+3) > section > .item-peek { grid-column: 1; grid-row: 1; }
  .item-peek {
    max-height: 10rem;
    overflow-x: hidden;
    overflow-y: scroll;
  }
  a.item-entry:nth-child(4n+1) > section > .item-peek { margin-inline-end: 0.5em; }
  a.item-entry:nth-child(4n+3) > section > .item-peek { margin-inline-start: 0.5em; }
  .item-peek > p {
    display: flex;
    flex-direction: column;
    min-block-size: calc(100% - 2em); /* 100% - 2 * margin-block */
  }
  .item-peek > p > span.intro-text {
    flex-grow: 1;
  }
  .item-peek > p > span.date-container {
    float: unset;
    margin-inline: 0;
    margin-block-start: 0.5em;
    flex-grow: 0;
  }
  a.item-entry:nth-child(4n+1) span.date-container { text-align: end; }
  a.item-entry:nth-child(4n+3) span.date-container { text-align: start; }
}
{{@ end }}
</style>
