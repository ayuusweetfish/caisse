<header>
  <h1>{{ title }}</h1>
</header>

{{
hextint = function (r, g, b)
  if not g then r, g, b = table.unpack(r) end
  return string.format('#%02x%02x%02x', r, g, b)
end

normaliselum = function (val, r, g, b)
  if g then r = {r, g, b}
  else r = {r[1], r[2], r[3]} end
  -- https://stackoverflow.com/q/596216
  for i = 1, 3 do
    local v = r[i] / 255
    if v <= 0.04045 then v = v / 12.92
    else v = ((v + 0.055) / 1.055) ^ 2.4 end
    r[i] = v
  end
  local y = r[1] * 0.1216 + r[2] * 0.7152 + r[3] * 0.0722

  local function invgamma(v)
    if v <= 0.0031308 then v = v * 12.92
    else v = 1.055 * (v ^ (1/2.4)) - 0.055 end
    return math.floor(math.min(1, v) * 255 + 0.5)
  end
  local weight = val / y * 0.8 + 0.2
  return
    invgamma(r[1] * weight),
    invgamma(r[2] * weight),
    invgamma(r[3] * weight)
end
}}

{{pendingtext.zh=}}等待中～
{{pendingtext.en=}}Pending~

{{@ list in {friendlist, webringlist} }}
<div role='separator' class='windy'></div>

{{@ list }}
<a class='friend-item'
  style="
    color: {{ hextint(normaliselum(0.1, tint)) }};
    border-color: {{ hextint(tint) }};
    {{@ bgimg }}background-image: url({{ file(bgimg, 'items/' .. name) }});{{@ end }}
  "
  href='{{ link }}'
>
<div class='text'>
  <h1>{{ title }}{{@ pending }} <span title='{{ pendingtext }}'>※</span>{{@ end }}</h1>
  {{@ author }}<p>{{ author }}</p>{{@ end }}
  <p>{{ link:match('^https?://([^/]+)') }}</p>
</div>
</a>
{{@ end }}
{{@ end }}

<style>
.friend-item {
  display: block;
  text-decoration: none;
  margin-block: 1em;
  min-block-size: 9.75em;
  margin-inline: 1.5em;
  padding-inline: 2em;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: 85% 50%;
}
.friend-item:nth-of-type(2n+1) {
  border-inline-start: 0.12em solid black;
}
.friend-item:nth-of-type(2n) {
  text-align: right;
  border-inline-end: 0.12em solid black;
  background-position: 15% 50%; /* Spell out fully for NetSurf compatibility */
}
@media (max-width: 115vh), (max-width: 48rem) {
  .friend-item {
    margin-inline: 0.5em;
    padding-inline: 1.5em;
  }
  .friend-item:nth-of-type(2n+1) {
    background-position: 90% 50%;
  }
  .friend-item:nth-of-type(2n) {
    background-position: 10% 50%;
  }
}
.friend-item .text {
  padding-block: 0.5em;
}
@supports (transform: translateY(-50%)) {
  .friend-item .text {
    padding: 0;
    position: relative;
    inset-block-start: 4.8em;
    transform: translateY(-50%);
  }
}
.friend-item h1 {
  font-size: 1.333rem;
}
</style>

<div role='separator' class='windy'></div>
