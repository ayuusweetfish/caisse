{{title.zh=}}Canta-Cart
{{intro.zh=}}ä½æˆæœ¬å¡ç‰‡æ‹‡æŒ‡ç´
{{title.en=}}Canta-Cart
{{intro.en=}}Low-cost card-sized musical instrument with touch keys

{{bannerimg=}}Cover.jpg
{{bannerimgpos=}}50,30
{{bannerimgalt.zh=}}å †æ”¾çš„å¡ç‰‡å½¢çŠ¶ç”µå­è£…ç½®ã€‚
{{bannerimgalt.en=}}A stack of card-sized electronic devices.

{{date=}}2024.09,2024.11
{{usemath=}}true

{{contents.zh=}}
!<note <link https://hackaday.io/contest/195949-2024-business-card-contest Hackaday 2024 åç‰‡æŒ‘æˆ˜>æäº¤ä½œå“ã€‚>

<b Canta-Cart> æ˜¯ä¸€ä»¶è§¦æ‘¸å¼ä¹å™¨/åˆæˆå™¨ã€‚å®ƒä»…æœ‰æ ‡å‡† ID-1 å¡ç‰‡å¤§å°ï¼ˆ85.6 Ã— 53.98 mmï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥éšèº«æºå¸¦çš„å°ä¹å™¨ï¼Œèƒ½æˆä¸ºä»»ä½•äººæ‰‹é‡Œçš„å°ç©å…·ï¼Œäº¦èƒ½åœ¨ç†Ÿç»ƒç©å®¶çš„æ‰‹ä¸­å¤§æ˜¾ç¥é€šã€‚å®ƒå³æ’å³ç”¨ï¼Œä¸€ä¸ªå°å°çš„ USB-C ç”µæºå¯ä»¥å¸¦ç€å®ƒçš„å£°éŸ³èµ°éä¸–ç•Œã€‚ææ–™æ¸…å•çš„æ€»æˆæœ¬ä¸ºäººæ°‘å¸ 5 å…ƒï¼ˆæŠ˜åˆçº¦ 0.7 ç¾å…ƒï¼‰ã€‚

æ¼”ç¤ºä¹æ›²â€”â€”
!<list
  <li ã€Šäººç”Ÿçš„æ—‹è½¬æœ¨é©¬ã€‹ï¼ˆ<lang en <it Merry-Go-Round of Life>>ï¼‰â€”â€”ç”µå½±ã€Šå“ˆå°”çš„ç§»åŠ¨åŸå ¡ã€‹æ’æ›²ï¼›ä¹…çŸ³è®©ä½œæ›²>
  <li ã€ŠçŸ­é€”æ—…è¡Œã€‹ï¼ˆ<lang en <it A Short Hike>>ï¼‰â€”â€”ç”µå­æ¸¸æˆé…ä¹æ—‹å¾‹ä¸»é¢˜ï¼›Mark Sparling ä½œæ›²>
  <li ã€Šç™½é¸½ä¸å°‘å¹´ã€‹ï¼ˆ<lang ja ãƒãƒˆã¨å°‘å¹´>ï¼‰â€”â€”ç”µå½±ã€Šå¤©ç©ºä¹‹åŸã€‹æ’æ›²ï¼›ä¹…çŸ³è®©ä½œæ›²>
>

!<filetable
  <file Merry-Go-Round.mp4 ã€Šäººç”Ÿçš„æ—‹è½¬æœ¨é©¬ã€‹>
  <file A-Short-Hike.mp4 ã€ŠçŸ­é€”æ—…è¡Œã€‹>
  <file Pigeons.mp4 ã€Šç™½é¸½ä¸å°‘å¹´ã€‹>
>

!<hr>

é™¤äº†å®ä½“è£…ç½®å¤–ï¼Œä¹å™¨ä¹Ÿå¯ä»¥<subpagelink canta-cart/play åœ¨æµè§ˆå™¨ä¸­æ¸¸ç©>ã€‚

!<note ä»¥ä¸‹å†…å®¹ä¸ <link https://hackaday.io/project/196643-canta-cart/details Hackaday é¡¹ç›®è¯¦æƒ…>ä¸€è‡´ã€‚ä¸­æ–‡ç‰ˆæœ¬åŸºäºæœºå™¨ç¿»è¯‘ä¿®è®¢ã€‚>

!<h1 ğŸ›ï¸ æ“ä½œ>

å¡ç‰‡ä¸Šæœ‰ 12 ä¸ªè§¦æ‘¸æŒ‰é”®ï¼ˆ10 ä¸ªç”¨äºå‘å£°ï¼Œ2 ä¸ªç”¨äºè½¬è°ƒï¼‰ã€‚å‘å£°æŒ‰é”®å¯¹åº”è‡ªç„¶å¤§è°ƒéŸ³é˜¶ä¸­çš„ä¹éŸ³ï¼Œè·¨è¶Šååº¦éŸ³ç¨‹ã€‚

!<img keyboard-10-keys.png <= æŒ‰é”®å¸ƒå±€ä¸éŸ³é«˜ï¼ˆéŸ³åï¼‰å¯¹åº”å…³ç³»ç¤ºæ„å›¾ã€‚> syncdarkmild>

è½¬è°ƒæŒ‰é’®æä¾›äº†å¤šç§æ‰©å±•æ–¹æ³•ã€‚æ“ä½œæ–¹å¼å¦‚ä¸‹ï¼š
!<list
  <li æŒ‰ä¸€æ¬¡ï¼šæ²¿éŸ³é˜¶ç§»åŠ¨ã€‚>
  <li æŒ‰ä½çš„åŒæ—¶æ¼”å¥ä¸€ä¸ªéŸ³ç¬¦ï¼šä¸´æ—¶å‡é™åŠéŸ³ã€‚>
  <li æŒ‰ä½å…¶ä¸€çš„åŒæ—¶æŒ‰ä¸‹å¦ä¸€ä¸ªï¼šæ•´ä½“ç§»è°ƒã€‚>
>

!<img keyboard-transpose.png <= ç§»è°ƒæŒ‰é”®æ“ä½œç¤ºæ„å›¾ã€‚> vertical syncdarkmild>

å…¶èƒŒåçš„è€ƒé‡æ˜¯ï¼Œå¤§å¤šæ•°æ—‹å¾‹ï¼ˆåœ¨ä¸è¥¿æ–¹è°ƒæ€§ç†è®ºç›¸å…¼å®¹çš„éŸ³ä¹æ–‡åŒ–ä¸­ï¼‰çš„éŸ³åŸŸéƒ½åœ¨ååˆ†ä¹‹ä¸€å·¦å³ï¼Œè‡³å°‘åœ¨çŸ­æ—¶é—´å†…æ˜¯å¦‚æ­¤ï¼›è¿™æ˜¯å› ä¸ºäººå£°çš„éŸ³åŸŸå¤§è‡´ç¬¦åˆè¿™ä¸€èŒƒå›´ï¼Œè€Œä¹å™¨å’Œä½œå“å¸¸å¸¸å€¾å‘äºæ¨¡ä»¿äººå£°ï¼Œæˆ–æ˜¯å¼•å‘äººå£°çš„æ„Ÿè§‰ã€‚å› æ­¤ï¼Œå¯¹äºæ¼”å¥è€…æ¥è¯´ï¼Œåä¸ªè°ƒå¤§å¤šè¶³ä»¥é‡ç°å¤§å¤šæ•°æ—‹å¾‹ã€‚åœ¨éœ€è¦çš„æƒ…å†µä¸‹ï¼Œç§»è°ƒæŒ‰é’®å¯ä»¥æ‰“å¼€é€šå¾€åéŸ³å¤§è°ƒéŸ³é˜¶ä»¥å¤–éŸ³é«˜çš„é€šé“ï¼Œè¦†ç›–å…¶ä½™æƒ…å†µï¼Œå¹¶ä¸ºå’Œå£°ã€éŸ³ä¹çº¹ç†ç­‰æä¾›ä¸°å¯Œçš„æœºä¼šï¼Œä½¿ç»†è…»çš„éŸ³ä¹è¡¨è¾¾æˆä¸ºå¯èƒ½ã€‚

!<h1 âš™ï¸ å†…éƒ¨åŸç†>

ï¼ˆè¯¦æƒ…è¯·å‚è€ƒ<link https://github.com/ayuusweetfish/Canta-Cart/blob/master/fw/src/main.c å›ºä»¶æºç¨‹åº>ã€‚ï¼‰

!<h2 ç”µå®¹ä¼ æ„Ÿ>

è§¦æ‘¸æ„Ÿåº”æ˜¯åˆ©ç”¨ RC ç½‘ç»œçš„é˜¶è·ƒå“åº”å®ç°çš„ã€‚

ç”µè·¯ç”±ä¸€ä¸ªä¸æ„Ÿåº”ç”µæä¸²è”çš„å¤§ç”µé˜»å™¨ï¼ˆçº¦ 1 MÎ©ï¼‰ç»„æˆã€‚åè€…å¯è¢«è§†ä¸ºç”µè·¯æ¥åœ°ï¼ˆä¸ä¸€å®šæ˜¯æ¥åœ°ï¼Œç”µæ± è´Ÿæä¹Ÿå¯ä»¥ï¼‰çš„ç”µå®¹å™¨ï¼Œå…¶å€¼ä¼šéšç€äººä½“éƒ¨ä½çš„æ¥è¿‘è€Œå¢åŠ ã€‚é©±åŠ¨å¼•è„šä¸ºç½‘ç»œæä¾›é˜¶è·ƒä¿¡å·ï¼ˆå³å°†å…¶é©±åŠ¨ä¸ºé«˜ç”µå¹³ï¼‰ï¼Œå¹¶ç›‘æµ‹ç”µé˜»ä¸Šçš„ç”µå‹å˜åŒ–ï¼Œç­‰å¾…ä¼ æ„Ÿå¼•è„šå˜ä¸ºâ€œé€»è¾‘é«˜ç”µå¹³â€ã€‚ç”±äºè¯¥ç½‘ç»œçš„é˜¶è·ƒå“åº”æ˜¯ä¸€ä¸ªæŒ‡æ•°å‡½æ•°ï¼ˆå…¶æ¨å¯¼è¿‡ç¨‹åœ¨ä»»ä½•åŸºç¡€ç”µå­å­¦æ•™ç§‘ä¹¦ä¸­éƒ½æœ‰è§£é‡Šï¼‰ï¼Œå› æ­¤æ„Ÿåº”ç‚¹çš„ç”µå‹è¦ä¸Šå‡åˆ°é€»è¾‘é«˜ç”µå¹³é˜ˆå€¼ <math V_\mathrm{IH} = k \cdot V_\mathrm{CC}> ä»¥ä¸Šï¼ˆå…¸å‹å€¼ <math k = 0.7>ï¼‰ï¼Œæ‰€éœ€çš„æ—¶é—´ä¸º <math -\ln (1 - k) \cdot RC>ï¼Œä¸æ„Ÿåº”ç”µå®¹ <math C> æˆçº¿æ€§å…³ç³»ã€‚

!<img sense-circuit.png <= ä¼ æ„Ÿç”µè·¯ç¤ºæ„å›¾ã€‚>>

å¯ä»¥<link https://www.falstad.com/circuit/circuitjs.html?ctz=CQAgjCAMB0l3BWK0AsYBMBmTD0E48B2dANjwA50xMQFJaQUaEBTAWjDACgAnEc+mBKDCJcMKjh48LgGMQ6SOXH10xFZNYcI9SFwDmC9UNXHRkvZhLKw5k+DvobkgDp6ASv0EShG1VLgFaCR0YItgrgAPWhsUPBA8JDBcRnEQABEeAEsANxYo8AQITniwPDEMdFTfAGUWADsAZ3yAdwcKiUUbCT022zE1Kq6jKstrdpGJ9BRBVz1DQcnFp2VdOQUlJfVFwXYwXSheL0n+ycFpOC42gUmb+z1o4eoINSTMFGqxAFEAGxZZAAuPAA9gATfLA6qSSp4HSwOBw+A6EA0ZHxPRAA åœ¨æ­¤>è¿è¡Œç”µè·¯çš„æ¨¡æ‹Ÿã€‚

!<h2 éŸ³é¢‘åˆæˆ>

åˆæˆå™¨æ˜¯ä¸€ä¸ªåŸºç¡€çš„æ³¢è¡¨ä¸‰è§’æ³¢åˆæˆå™¨ï¼Œç»“åˆäº†ä¸€ä¸ª <lang en attack/release> åŒ…ç»œã€‚æ‰€æœ‰è®¡ç®—å‡é‡‡ç”¨ 32 ä½æ•´æ•°ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†åˆæˆæ—¶é—´ï¼Œå¹¶å°†æ•´ä½“å»¶è¿Ÿæ—¶é—´é™è‡³ 1 æ¯«ç§’ä»¥ä¸‹ã€‚

!<h2 éŸ³é¢‘è¾“å‡º>

éŸ³é¢‘é€šè¿‡ç”±å­—é€‰æ‹© (WS)ã€ä½æ—¶é’Ÿ (BCK) å’Œä¸²è¡Œæ•°æ® (DATA) ä¸‰ä¸ªä¿¡å·ç»„æˆçš„æ•°å­—æ€»çº¿å‘é€åˆ° DACã€‚ç”µè·¯ä¸­çš„ DAC IC æ¥æ”¶çš„å¼ LSBJ æ ¼å¼ï¼Œè¿™ä¸æ ‡å‡† IÂ²S æ ¼å¼éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬çš„å¾®æ§åˆ¶å™¨æ²¡æœ‰ç›´æ¥é€‚é…æ­¤ç±»æ ¼å¼çš„å¤–è®¾ï¼Œä½†åœ¨é™åˆ¶ä¹‹å†…ä¹Ÿæœ‰å¯è¡Œæ–¹æ¡ˆï¼šBCK å’Œ DATA å¯ç”± SPI è¾“å‡ºè¦†ç›–ï¼ŒWS å¯ç”±ç»†å¿ƒä½œå¥½åŒæ­¥çš„ PWM å®šæ—¶å™¨é€šé“æä¾›ã€‚DMA æä¾›ä¸€ä¸ªâ€œåŠå®Œæˆâ€ï¼ˆ<lang en half-complete>ï¼‰ä¸­æ–­ï¼Œç®€åŒ–äº†åŒç¼“å†²çš„å®ç°ã€‚

ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›å¥‡æ€ªçš„é™åˆ¶ï¼Ÿå½“ç„¶æ˜¯ä¸ºäº†èŠ‚è¡£ç¼©é£Ÿï¼è¿™å°±å¼•å‡ºäº†â€¦â€¦

!<h1 ğŸ”¥ The Muntz Wildcard>

æ€§ä»·æ¯”æ˜¯è®¾è®¡ä¸­çš„é¦–è¦è€ƒè™‘å› ç´ ä¹‹ä¸€ã€‚å› æ­¤ï¼Œåœ¨å®æ–½è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›è’å”çš„ç°è±¡ï¼Œä½†æ•´ä»¶è£…ç½®æœ€ç»ˆæ‹¼å‡‘èµ·æ¥çš„é‚£ä¸€åˆ»ï¼Œä¾¿å®ç°äº†æ¯ä»¶ 5 å…ƒçš„è¶…ä½åŸæ–™æˆæœ¬ã€‚ç”±äºå¦‚ä»Šä¸å°‘å‚å®¶éƒ½ä¸ºè¿™ç§å°ºå¯¸çš„ç”µè·¯æ¿æä¾›å…è´¹çš„æ‰“æ ·æœåŠ¡ï¼Œä»¥ä¸Šå°±æ˜¯è®¾å¤‡çš„æœ€ç»ˆåˆ¶é€ æˆæœ¬ã€‚ï¼ˆæ‰€æœ‰å…ƒä»¶éƒ½å¯ä»¥ç”¨çƒ­é£æªæˆ–çƒ™é“æ‰‹å·¥ç„Šæ¥ï¼›æˆ‘å¹¶éç»éªŒä¸°å¯Œçš„åˆ¶ä½œè€…ï¼Œæˆ‘ç›®å‰ä¸“æ³¨äºè®¾è®¡ï¼Œç”µå­åˆ¶ä½œä»…æ˜¯å‰¯ä¸šï¼Œä½†æˆ‘åªç”¨ç„Šè†å’Œçƒ­é£æªå°±å®Œæˆäº†æ‰€æœ‰å·¥ä½œï¼Œæ²¡æœ‰ä½¿ç”¨é’¢ç½‘ã€æ”¾å¤§é•œæˆ–åŠ©ç„Šå‰‚ã€‚ä¸è¿‡æ¯ä¸ªäººçš„æƒ…å†µä¹Ÿä¼šä¸åŒå•¦ã€‚ï¼‰

å¾®æ§åˆ¶å™¨æ˜¯è£…ç½®çš„æ ¸å¿ƒï¼Œé€šå¸¸ä¹Ÿæ˜¯åŸæ–™æˆæœ¬çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨æœ¬è®¾è®¡ä¸­ï¼Œæˆ‘é€‰æ‹©äº† PY32ï¼Œè¿™æ˜¯åŠå¯¼ä½“å…¬å¸æ™®å†‰ï¼ˆPuyaï¼‰æ¨å‡ºçš„ Arm Cortex-M å¾®æ§åˆ¶å™¨ç³»åˆ—ã€‚å…¥é—¨äº§å“çº¿ PY32F002/3 çš„å®šä»·ä»¤äººå°è±¡æ·±åˆ»ï¼Œä½è‡³ 1 å…ƒä»¥å†…ã€‚PY32F003 å‹å·çš„è¿è¡Œé¢‘ç‡ä¸º 32 MHzï¼Œå¤–è®¾åŒ…æ‹¬å®šæ—¶å™¨ã€SPI å’Œ DMAï¼Œéå¸¸é€‚åˆæˆ‘ä»¬çš„è¿ç»­æ•°å­—éŸ³é¢‘è¾“å‡ºä½¿ç”¨åœºæ™¯ã€‚éŸ³é¢‘ DAC å’Œæ”¾å¤§å™¨ IC ä¹Ÿæ˜¯ä½æˆæœ¬å‹å·ï¼Œä½†è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„åº”ç”¨éœ€æ±‚ã€‚

æˆ‘ç°å±…ä¸­å›½å¢ƒå†…ï¼Œä»æ·˜å®ä¸Šçš„ä¸€å®¶å¤§å‹ç»é”€å•†å¤„è´­ä¹°å…ƒä»¶çš„æ€»æˆæœ¬ä¸ºæ¯å° 4 å…ƒï¼ˆæ•°é‡ 1+ å¯¹åº”çš„é˜¶æ¢¯ä»·æ ¼ï¼‰ã€‚çŸ¥åçš„åœ¨çº¿åˆ†é”€å•†åœ¨è®¢è´­æ•°é‡è¾ƒå°‘çš„æƒ…å†µä¸‹å¯èƒ½ä»·æ ¼ä¼šç•¥é«˜ï¼Œä½†æ•°å­—ç›¸å·®ä¸å¤§ï¼Œæœ€é«˜å³ä¸ºå‰è¿°çš„çº¦ 5 å…ƒã€‚

éŸ³ä¹ä»æ¥ä¸åªå±äºéƒ¨åˆ†äººã€‚å…¨ä¸–ç•ŒéŸ³ä¹æ¢¦æƒ³å®¶ï¼Œè”åˆèµ·æ¥ï¼

!<h1 âœ¨ åç‰‡â€¦â€¦ï¼Ÿ>

åç‰‡ç¦»ä¸å¼€ä¸ªäººåŒ–çš„äº¤æµï¼›æˆ‘å·²ç»å¼€å§‹å°†è¿™äº›é€ç»™å‘¨å›´çš„æœ‹å‹ã€‚èƒŒé¢å°æœ‰ä¸ªäººç½‘ç«™å’Œä¸€ä¸ªå°å›¾æ ‡ã€‚è¿™ä¸ªå›¾æ ‡éšæ™¦åœ°æ‹¼å‡ºä¸€ä¸ªéŸ³ä¹ç‰‡æ®µï¼Œæˆ‘ç§°å…¶ä¸ºâ€œ<lang en sweetfish> æ—‹å¾‹åŠ¨æœºâ€ã€‚æˆ‘æƒ³ç»™é¦–ä½æ­£ç¡®è§£è¯»å®ƒçš„äººèµ é€ä¸€å¼ å¡ç‰‡ã€‚å¦‚æœä½ èƒ½çœ‹æ˜ç™½ï¼Œè¯·ç»™æˆ‘å‘ä¿¡æ¯ (^ -)â˜†

!<img Rev-1-Assembly.jpg <= ç»„è£…å®Œæ¯•çš„è£…ç½®ï¼ŒèƒŒé¢å°åˆ·çš„å›¾æ¡ˆé¢æœä¸Šæ–¹ã€‚//å†™é”™äº†ï¼Œå…¶å®æ˜¯ç¬¬ä¸€ç‰ˆå“’> caption>

{{contents.en=}}
!<note A submission to the <link https://hackaday.io/contest/195949-2024-business-card-contest Hackaday 2024 Business Card Challenge>.>

<b Canta-Cart> is a touch-operated musical instrument/synthesiser that takes the dimensions of a standard ID-1 card (85.6 Ã— 53.98 mm). A portable little tune-maker in the pocket, it is easy for anyone to get hands on, yet versatile enough for the more aspiring of minds. It is plug-and-play â€” a USB-C power supply will take its sounds anywhere. The BOM adds up to a cost of CNÂ¥5 / US$0.7.

Music for demonstration:
!<list
  <li <it Merry-Go-Round of Life> â€” music from the film <it Howlâ€™s Moving Castle>; composed by Joe Hisaishi.>
  <li <it A Short Hike> â€” melodic theme of the video game; composed by Mark Sparling.>
  <li <it Pigeons and a Boy> (<lang ja ãƒãƒˆã¨å°‘å¹´>) â€” music from the film <it Laputa: Castle in the Sky>; composed by Joe Hisaishi.>
>

!<filetable
  <file Merry-Go-Round.mp4 <it Merry-Go-Round of Life>>
  <file A-Short-Hike.mp4 <it A Short Hike>>
  <file Pigeons.mp4 <it Pigeons and a Boy>>
>

!<hr>

Apart from the actual device, the instrument can also be played <subpagelink canta-cart/play right in the browser>.

!<note The following content is the same as the <link https://hackaday.io/project/196643-canta-cart/details project details on Hackaday>.>

!<h1 ğŸ›ï¸ Controls>

On the card are 12 touch keys (10 for sounds, 2 for transposition). The sounding keys correspond to the pitches in a diatonic major scale, spanning a tenth interval.

!<img keyboard-10-keys.png <= An illustration of the layout of the keys and how they map to pitches or musical notes.> syncdarkmild>

The transpose buttons open up to a variety of ways to extend this. They work as follows:
!<list
  <li Press once: move along the scale.>
  <li Hold and play a note: accidentals.>
  <li Press one while holding the other: key change.>
>

!<img keyboard-transpose.png <= Diagrams of transpose buttons being operated.> vertical syncdarkmild>

The rationale is that most melodies (in music cultures compatible with the Western tonal theory) span a pitch range of around a tenth, at least over short periods, due to the register of the human voice and how musical instruments and compositions tend to imitate and invoke it. Thus, ten keys are mostly sufficient for a player to reproduce most melodies. The transpose buttons open a way to pitches beyond the ten-note major scale in cases where they are needed, covering the remaining cases as well as providing abundant chances for harmonies, musical textures, etc., through which delicate musical expression becomes more than possible.

!<h1 âš™ï¸ Inner Workings>

(Please refer to the <link https://github.com/ayuusweetfish/Canta-Cart/blob/master/fw/src/main.c firmware source> for all details.)

!<h2 Capacitive Sensing>

Touch sensing is achieved by utilising the step response of an RC network.

The circuit consists of a large resistor (~1 MÎ©) in series with the sensing electrode. The latter can be treated as a capacitor to the circuitâ€™s ground (not necessarily earth; a battery negative reference works just fine), whose value increases as human body parts approach it. A driving pin feeds the network with a step signal (namely, drives it high) and monitors the voltage change across the resistor, waiting for the sensing pin to go â€œlogical highâ€. As the step response of this network is an exponential function (the derivation of which is explained in any basic electronics textbook), for the voltage at the sensing point to rise above the logical high threshold <math V_\mathrm{IH} = k \cdot V_\mathrm{CC}> (with a typical value of <math k = 0.7>), the time taken is <math -\ln (1 - k) \cdot RC> which is linearly dependent on the sensed capacitance <math C>. By repeatedly sampling GPIO pins, the capacitance values at all electrodes can be straightforwardly deduced.

!<img sense-circuit.png <= Diagram of a sensing circuit.>>

Run a simulation of the circuit <link https://www.falstad.com/circuit/circuitjs.html?ctz=CQAgjCAMB0l3BWK0AsYBMBmTD0E48B2dANjwA50xMQFJaQUaEBTAWjDACgAnEc+mBKDCJcMKjh48LgGMQ6SOXH10xFZNYcI9SFwDmC9UNXHRkvZhLKw5k+DvobkgDp6ASv0EShG1VLgFaCR0YItgrgAPWhsUPBA8JDBcRnEQABEeAEsANxYo8AQITniwPDEMdFTfAGUWADsAZ3yAdwcKiUUbCT022zE1Kq6jKstrdpGJ9BRBVz1DQcnFp2VdOQUlJfVFwXYwXSheL0n+ycFpOC42gUmb+z1o4eoINSTMFGqxAFEAGxZZAAuPAA9gATfLA6qSSp4HSwOBw+A6EA0ZHxPRAA here>.

!<h2 Audio Synthesis>

The synthesiser is a basic triangle wavetable synth combined with an attack/release envelope. All calculations are carried out with 32-bit integers, minimising the time spent in synthesis and reducing overall latency to under 1 ms.

!<h2 Audio Output>

Audio is sent to a DAC through a digital bus comprising three signals: word select (WS), bit clock (BCK), and serial data (DATA). The DAC IC in the circuit expects the LSBJ format, which closely resembles the standard IÂ²S. Our microcontroller does not have a ready-to-go peripheral for such formats, but it is possible to work within the limitation: BCK and DATA can be covered by an SPI output, and WS can be supplied by a carefully synchronised PWM timer channel. The DMA provides a half-complete interrupt, easing the implementation of a double buffer.

Why do these strange limitations arise? To squeeze out every penny/cent, of course! Which leads us toâ€¦

!<h1 ğŸ”¥ The Muntz Wildcard>

Cost-effectiveness was an overarching consideration in the design. This gave rise to a few absurdities in the implementation, but as things were pieced together, they amounted to a knockdown BOM cost of US$0.6 per unit. As quite a few PCB houses now provide free prototyping services for boards of this size, this is the final manufacturing cost of the device. (Components can all be manually soldered with a hot air gun or an iron; Iâ€™m by no means a seasoned maker as electronics is only my side research as a design-focused student, but I did it all simply with solder paste and a hot air gun, without a paste stencil, a magnifying glass, or solder flux. YMMV, though.)

The microcontroller is at the heart of the device and often a major contributor to the BOM cost. For this design, I looked at PY32, an Arm Cortex-M microcontroller series by the semiconductor company Puya. The entry product line, PY32F002/3, features an impressively low cost of down to US$0.1 per unit. The PY32F003 model runs at 32 MHz and has timers, SPI, and DMA in its peripherals, closely fitting our use case of continuous digital audio output. The audio DAC and amplifier ICs are also low-cost models, but are more than sufficient for our application.

Being China-based, I obtained a combined cost of CNÂ¥4/US$0.6 per unit (at quantities of 1+) ordering components from a large reseller on Taobao. Renowned online distributors may have a slightly higher price at lower quantities, but the figures do not differ by much, capping at around the aforementioned US$0.7.

Music is never a meritocracy. Musical dreamers of the world, unite!

!<h1 âœ¨ Businessâ€¦?>

Business cards are never complete without getting personal. I have already been giving away these to friends around. On the back side are printed my personal website and a signature in the form of an icon. The graphic obscurely spells a musical phrase that I dub â€œthe sweetfish motifâ€. Iâ€™m willing to send a card to whoever correctly decodes it first. If you do, please message me (^  -)â˜†

!<img Rev-1-Assembly.jpg <= Assembled devices with graphics printed on the back side facing up.//I spelt it wrong, this was revision 1> caption>


{{toc=}}true

{{rellinks.zh=}}
!<list
  <li <subpagelink canta-cart/play åœ¨çº¿æ¸¸ç©é¡µé¢>>
  <li <link https://hackaday.io/project/196643-canta-cart Hackaday é¡¹ç›®é¡µé¢>>
  <li <link https://github.com/ayuusweetfish/Canta-Cart å¼€æºèµ„æ–™ä»“åº“>>
>

{{rellinks.en=}}
!<list
  <li <subpagelink canta-cart/play Online play page>>
  <li <link https://hackaday.io/project/196643-canta-cart Hackaday project page>>
  <li <link https://github.com/ayuusweetfish/Canta-Cart Open-source material repository>>
>
